sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast"],function(e,t){"use strict";return e.extend("poc.centi.mark.centimarkui.controller.Notifications",{onInit:function(){this.oRouter=this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("NoticeView").attachMatched(this.handleRouteMatched,this)},AddressPopup:null,handleRouteMatched:function(e){},onListButtonPress:function(e){var i=e.getSource().getProperty("text");this.NotificationData=e.getSource().getParent().getBindingContext().getObject();this.oNOT_NO=this.NotificationData.NOT_NO;var o=e.getSource().getParent().getBindingContext().getObject().NOT_NUM;this.getView().getModel("local").setProperty("/NotificationNum",o);if(i.toUpperCase()=="START WORK"){var n={WP_STATUS:"CONTINUE WORK",STATUS:"IN-PROGRESS"};var a=this.getView().getModel();a.update(`/NotificationsSet(NOT_NO=guid'`+this.oNOT_NO+`')`,n);a.refresh();if(!this.AddressPopup){this.AddressPopup=sap.ui.xmlfragment("poc.centi.mark.centimarkui.fragments.details",this);this.getView().addDependent(this.AddressPopup)}this.AddressPopup.open()}else if(i.toUpperCase()=="SUSPENDED TICKET"){t.show("You can't start work on a Suspended Ticket")}else if(i.toUpperCase()=="CONTINUE WORK"){this.oRouter.navTo("repairScreen",{NtfID:this.NotificationData.NOT_NO})}else{var n={WP_STATUS:"START WORK",STATUS:"Travel"};var a=this.getView().getModel();a.update(`/NotificationsSet(NOT_NO=guid'`+this.oNOT_NO+`')`,n);a.refresh()}},onRefresh:function(){this.getView().getModel().refresh()},onFilter:function(){t.show("Functionality will implemented soon")},onCreateNotifications:function(){var e={USERNAME:"",CUSTOMER:"",STATUS:"SCHEDULED",DESCRIPTION:"",JOB_TYPE:"",WP_STATUS:"START TRAVEL"};this.getView().getModel("local").setProperty("/NewNotification",e);if(!this.CreateNotification){this.CreateNotification=sap.ui.xmlfragment(this.getView().getId(),"poc.centi.mark.centimarkui.fragments.CreateNotification",this);this.getView().addDependent(this.CreateNotification)}this.CreateNotification.open();this.CreateNotification.bindElement("local>/NewNotification")},onCancelNotif:function(){this.CreateNotification.close()},onClickCreate:function(e){debugger;var i=this.getView().getModel("local").getProperty("/NewNotification");var o=this.getView().byId("idJob").getSelectedKey();i.JOB_TYPE=o;var n=this.getView().getModel();n.create("/NotificationsSet",i,{success:function(e){t.show("Notification Created Successfully")},error:function(e){t.show("Notification Creation Failed")}});this.CreateNotification.close()},iconNotifformatter:function(e){if(e.toUpperCase()=="REPAIRING"){return"./images/typ1.jpg"}else{return"./images/bucket.jpg"}},onCloseDetail:function(){this.AddressPopup.close()},onMapIconPress:function(){t.show("Maps not Available rigth now")},SignaturePopup:null,onContinueWork:function(){if(this.AddressPopup){this.onCloseDetail()}if(!this.SignaturePopup){this.SignaturePopup=sap.ui.xmlfragment(this.getView().getId(),"poc.centi.mark.centimarkui.fragments.SignaturePopup",this);this.getView().addDependent(this.SignaturePopup)}this.SignaturePopup.open();debugger;this.onSign()},onCloseSignature:function(){this.SignaturePopup.close()},onSign:function(e,t){var i=document.getElementById("signature-pad");var o=i.getContext("2d");i.width=750;i.height=400;o.fillStyle="#d9d9d9";o.lineWidth=1.5;o.lineCap="round";o.fillRect(0,0,i.width,i.height);var n=true;var a;var s=[];var r=[];var u={};var c={};var d=false;function p(){i.removeEventListener("mousemove",f,false);i.removeEventListener("mouseup",g,false);i.removeEventListener("touchmove",f,false);i.removeEventListener("touchend",g,false);document.body.removeEventListener("mouseup",g,false);document.body.removeEventListener("touchend",g,false)}function h(e){var t,o;if(e.changedTouches&&e.changedTouches[0]){var n=i.offsetTop||0;var a=i.offsetLeft||0;t=e.changedTouches[0].pageX-a;o=e.changedTouches[0].pageY-n}else if(e.layerX||0==e.layerX){t=e.layerX;o=e.layerY}else if(e.offsetX||0==e.offsetX){t=e.offsetX;o=e.offsetY}return{x:t,y:o}}function l(e){e.preventDefault();e.stopPropagation();i.addEventListener("mouseup",g,false);i.addEventListener("mousemove",f,false);i.addEventListener("touchend",g,false);i.addEventListener("touchmove",f,false);document.body.addEventListener("mouseup",g,false);document.body.addEventListener("touchend",g,false);a=false;var t=h(e);o.beginPath();s.push("moveStart");o.moveTo(t.x,t.y);s.push(t.x,t.y);u=t}function f(e,t){e.preventDefault();e.stopPropagation();var i=h(e);var n={x:(u.x+i.x)/2,y:(u.y+i.y)/2};if(d){var a=(c.x+u.x+n.x)/3;var r=(c.y+u.y+n.y)/3;s.push(a,r)}else{d=true}o.quadraticCurveTo(u.x,u.y,n.x,n.y);s.push(n.x,n.y);o.stroke();o.beginPath();o.moveTo(n.x,n.y);c=n;u=i}function g(e){p();n=false;o.stroke();s.push("e");d=false}i.addEventListener("touchstart",l,false);i.addEventListener("mousedown",l,false)},saveButton:function(e){var t=document.getElementById("signature-pad");var i=document.createElement("a");i.href=t.toDataURL("image/jpeg");i.download="sign.jpeg";i.click();var o=new SignaturePad(document.getElementById("signature-pad"),{penColor:"rgb(0, 0, 0)",velocityFilterWeight:.7,minWidth:.5,maxWidth:2.5,throttle:16,minPointDistance:3})},onClearSign:function(e){var t=document.getElementById("signature-pad");var i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);i.fillStyle="#d9d9d9";i.lineWidth=1.5;i.lineCap="round";i.fillRect(0,0,t.width,t.height);var o=new SignaturePad(document.getElementById("signature-pad"),{penColor:"rgb(0, 0, 0)",velocityFilterWeight:.7,minWidth:.5,maxWidth:2.5,throttle:16,minPointDistance:3})},skipReasonPopup:null,onSkipSign:function(){if(this.SignaturePopup){this.onCloseSignature()}if(!this.skipReasonPopup){this.skipReasonPopup=sap.ui.xmlfragment(this.getView().getId(),"poc.centi.mark.centimarkui.fragments.SkipReasonPopup",this);this.getView().addDependent(this.skipReasonPopup)}this.skipReasonPopup.open()},onCancelReason:function(){this.skipReasonPopup.close()},onProceedSign:function(){this.oRouter.navTo("repairScreen",{NtfID:this.NotificationData.NOT_NO})}})});