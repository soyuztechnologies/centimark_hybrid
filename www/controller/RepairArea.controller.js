sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","poc/centi/mark/centimarkui/utils/formatter"],function(e,t,i){"use strict";return e.extend("poc.centi.mark.centimarkui.controller.RepairArea",{formatter:i,onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("repairScreen").attachMatched(this.handleRouteMatched,this)},handleRouteMatched:function(e){var t=e.getParameter("arguments").NtfID;if(t){this.NotId=t;var i=this.getView().getModel();var n=i.createKey("/NotificationsSet",{NOT_NO:t});this.getView().bindElement(n,{expand:"NAVBuilding"})}this.LoadFirstBuilding(t,n);var i=this.getView().getModel();i.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay)},LoadFirstBuilding:function(e,t){if(e){var i=this;var n=this.getView().getModel();n.read(t,{urlParameters:{$expand:"NAVBuilding"},success:function(e){debugger;var t=e.NAVBuilding.results[0];var n=t.NOT_NO;var r=t.BUID_ID;i.BindDashbordToBuilding(n,r)},error:function(e){debugger}})}},BindDashbordToBuilding:function(e,t){if(e&&t){var i=this.getView().getModel();var n=i.createKey("/BuildingSet",{NOT_NO:e,BUID_ID:t});var r=this.getView().byId("repairAreaList");r.bindElement(n)}},onBack:function(){this.oRouter.navTo("NoticeView")},CreateBuilding:function(){},SetupPopup:null,onPressRepairTile:function(e){var t=e.getSource().getBindingContext().getObject();this.oRouter.navTo("safetyScreen",{NtfID:this.NotId,BuildID:t.BUID_ID})},onCancelSetup:function(){this.SetupPopup.close()},onConfirmSetup:function(){debugger;t.show("Will add the screen soon");this.SetupPopup.close()},editBuildingPopup:null,onEditBuilding:function(e){debugger;var t=e.getSource().getBindingContext().getPath();if(!this.editBuildingPopup){this.editBuildingPopup=sap.ui.xmlfragment(this.getView().getId(),"poc.centi.mark.centimarkui.fragments.EditBuildPopup",this);this.getView().addDependent(this.editBuildingPopup)}this.editBuildingPopup.open();this.editBuildingPopup.bindElement(t)},onCancelBuildPopup:function(){this.editBuildingPopup.close()},onConfirmBuild:function(e){debugger;var i=e.getSource().getBindingContext().getObject();var n=e.getSource().getBindingContext().getPath();var r=this;var o={NAME:i.NAME,COMMENTS:i.COMMENTS,PHOTO:i.PHOTO};var a=this.getView().getModel();a.update(n,o,{success:function(e){debugger;r.editBuildingPopup.close();t.show("Building Saved")},error:function(e){debugger}})},convertFileToUrl:function(e){var t=/data:(\w.*);base64,/gm;var i=t.exec(e),n=atob(e.replace(t,""));var r=new Uint8Array(n.length);for(var o=0;o<n.length;o++){r[o]=n.charCodeAt(o)}var a=new Blob([r.buffer],{type:i?i[1]:"application/pdf"});jQuery.sap.addUrlWhitelist("blob");return URL.createObjectURL(a)},onCaptureBuildImg:function(e){debugger;var t=this;var i=e.getParameter("files"),n=this.getView().byId("idBuildingImg"),r=this.getView().byId("idCameraIcon");if(!i){return}if(!i.length){}else{var o=new FileReader;o.onload=async function(e){try{debugger;var t=e.currentTarget.result;n.setSrc(t);n.setVisible(true);r.setVisible(false)}catch(e){console.log(e)}};o.readAsDataURL(i[0])}},onImgClick:function(e){debugger;this.getView().byId("fileUploderField").firePress}})});